<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Analyzer Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            width: 100%;
            max-width: 1200px;
            min-height: 600px;
            transition: all 0.3s ease;
        }

        /* Auth Pages */
        .auth-container {
            max-width: 400px;
            padding: 40px;
            text-align: center;
        }

        .auth-header {
            margin-bottom: 30px;
        }

        .auth-header h1 {
            color: #333;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .auth-header p {
            color: #666;
            font-size: 1.1rem;
        }
        .auth-logo {
    width: 80px;          /* adjust size */
    height: 80px;
    object-fit: contain;
    margin: 0 auto 15px;  /* center and add space below */
    display: block;
}


        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 600;
        }

        .form-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .auth-switch {
            margin-top: 25px;
            color: #666;
        }

        .auth-switch a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
        }

        .auth-switch a:hover {
            color: #764ba2;
        }

        /* Dashboard */
        .dashboard {
    display: none;
    flex-direction: column;
    width: 100%;
    height: 100vh;
}

        .dashboard.active {
            display: flex;
        }

        .dashboard-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
        }

        .dashboard-header h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .dashboard-content {
            flex: 1;
            display: flex;
            height: calc(100vh - 80px);
        }

        .sidebar {
            width: 300px;
            background: #f8f9fa;
            border-right: 1px solid #e1e5e9;
            padding: 20px;
            overflow-y: auto;
        }

        .upload-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .upload-section h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.2rem;
        }

        .file-upload {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .file-upload input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-upload-btn {
            display: block;
            width: 100%;
            padding: 12px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .file-upload:hover .file-upload-btn {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .file-info {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #666;
        }

        .data-preview {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .data-preview h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.2rem;
        }

        .preview-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.8rem;
        }

        .preview-table th,
        .preview-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #e1e5e9;
        }

        .preview-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        .main-content {
            flex: 1;
            padding: 20px;
            background: #f8f9fa;
            overflow-y: auto;
        }

        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            position: relative;
            height: 400px;
            
        }

        .chart-container h3 {
            margin-bottom: 20px;
            color: #333;
            font-size: 1.3rem;
            text-align: center;
        }

        .chart-canvas {
            position: relative;
            height: 600px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .controls {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .controls h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 600;
        }

        .control-group select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e1e5e9;
            border-radius: 6px;
            background: white;
            font-size: 14px;
        }

        .hidden {
            display: none !important;
        }

        .error-message {
            background: #fee;
            color: #c33;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-size: 0.9rem;
        }

        .success-message {
            background: #efe;
            color: #3c3;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-size: 0.9rem;
        }

        .no-data {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 40px;
        }

        @media (max-width: 768px) {
            .dashboard-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="container auth-container">
        <div class="auth-header">
            <h1>📊 DataPro</h1>
            <p>Powerful data analysis at your fingertip</p>
        </div>
        <form id="loginForm">
            <div class="form-group">
                <label for="loginEmail">Email Address</label>
                <input type="email" id="loginEmail" required placeholder="Enter your email">
            </div>
            <div class="form-group">
                <label for="loginPassword">Password</label>
                <input type="password" id="loginPassword" required placeholder="Enter your password">
            </div>
            <button type="submit" class="btn">Sign In</button>
            <div class="auth-switch">
                Don't have an account? <a id="showRegister">Create one</a>
            </div>
        </form>
    </div>

    <!-- Register Page -->
    <div id="registerPage" class="container auth-container hidden">
        <div class="auth-header">
            <h1>📊 DataPro</h1>
            <p>Join thousands of data analysts</p>
        </div>
        <form id="registerForm">
            <div class="form-group">
                <label for="registerName">Full Name</label>
                <input type="text" id="registerName" required placeholder="Enter your full name">
            </div>
            <div class="form-group">
                <label for="registerEmail">Email Address</label>
                <input type="email" id="registerEmail" required placeholder="Enter your email">
            </div>
            <div class="form-group">
                <label for="registerPassword">Password</label>
                <input type="password" id="registerPassword" required placeholder="Create a password">
            </div>
            <div class="form-group">
                <label for="confirmPassword">Confirm Password</label>
                <input type="password" id="confirmPassword" required placeholder="Confirm your password">
            </div>
            <button type="submit" class="btn">Create Account</button>
            <div class="auth-switch">
                Already have an account? <a id="showLogin">Sign in</a>
            </div>
        </form>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="dashboard">
        <header class="dashboard-header">
            <h1>📊 Data Analysis Dashboard</h1>
            <div class="user-info">
                <span id="welcomeUser">Welcome back!</span>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </header>
        
        <div class="dashboard-content">
            <aside class="sidebar">
                <div class="upload-section">
                    <h3>📁 Upload Data</h3>
                    <div class="file-upload">
                        <input type="file" id="dataFile" accept=".csv,.xlsx,.xls" onchange="handleFileUpload(event)">
                        <label for="dataFile" class="file-upload-btn">
                            Choose CSV or Excel File
                        </label>
                    </div>
                    <div id="fileInfo" class="file-info"></div>
                </div>
                
                <div class="controls">
                    <h3>⚙️ Chart Controls</h3>
                    <div class="control-group">
                        <label for="chartType">Chart Type</label>
          <div class="controls">
    <h3>⚙️ Chart Controls</h3>
    <div class="control-group">
        <label for="chartType">Chart Type</label>
        <select id="chartType">
            <optgroup label="Basic Charts">
                <option value="bar">Bar Chart</option>
                <option value="line">Line Chart</option>
                <option value="area">Area Chart</option>
            </optgroup>
            <optgroup label="Category Charts">
                <option value="pie">Pie Chart</option>
                <option value="doughnut">Doughnut Chart</option>
                <option value="polarArea">Polar Area Chart</option>
                <option value="radar">Radar Chart</option>
            </optgroup>
            <optgroup label="Numeric Charts">
                <option value="scatter">Scatter Plot</option>
                <option value="bubble">Bubble Chart</option>
            </optgroup>
        </select>
    </div>
    <div class="control-group">
        <label for="xAxis">X-Axis</label>
        <select id="xAxis">
            <option value="">Select column...</option>
        </select>
    </div>
    <div class="control-group">
        <label for="yAxis">Y-Axis</label>
        <select id="yAxis">
            <option value="">Select column...</option>
        </select>
    </div>

    <!-- 🎯 New Generate Button -->
    <div class="control-group">
        <button type="button" onclick="updateChart()" 
            style="width:100%; padding:12px; background:linear-gradient(45deg,#667eea,#764ba2); color:white; font-weight:600; border:none; border-radius:8px; cursor:pointer;">
            📊 Generate Chart
        </button>
    </div>
</div>

                    </div>
                </div>
            </aside>
            
            <main class="main-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalRows">0</div>
                        <div class="stat-label">Total Rows</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalColumns">0</div>
                        <div class="stat-label">Total Columns</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="numericColumns">0</div>
                        <div class="stat-label">Numeric Columns</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="textColumns">0</div>
                        <div class="stat-label">Text Columns</div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h3>📈 Data Visualization</h3>
                    <div class="chart-canvas">
                        <canvas id="mainChart"></canvas>
                        <div id="noChartMessage" class="no-data">
                            Upload data and select columns to create charts
                        </div>
                                         <button onclick="saveChartAsPDF()" 
    style="margin-top: 100px; padding: 10px 20px; border: none; border-radius: 8px; background: linear-gradient(45deg, #667eea, #764ba2); color: white; font-weight: 600; cursor: pointer;">
    📄 Save as PDF
</button>
                <div class="data-preview">
                    <h3>👀 Data Preview</h3>
                    <div id="dataPreview" class="no-data">
                        Upload a file to see preview
                    </div>
                </div>

                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        // Global variables
        let currentData = null;
        let currentChart = null;
        let users = JSON.parse(localStorage.getItem('datapro_users') || '{}');
        let currentUser = null;

        // Authentication functions
        function showLogin() {
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('registerPage').classList.add('hidden');
        }

        function showRegister() {
            document.getElementById('registerPage').classList.remove('hidden');
            document.getElementById('loginPage').classList.add('hidden');
        }

        function showDashboard() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('registerPage').classList.add('hidden');
            document.getElementById('dashboard').classList.add('active');
        }

        function logout() {
            currentUser = null;
            document.getElementById('dashboard').classList.remove('active');
            document.getElementById('loginPage').classList.remove('hidden');
            // Clear form data
            document.getElementById('loginForm').reset();
        }

        // Event listeners for auth
        document.getElementById('showRegister').onclick = showRegister;
        document.getElementById('showLogin').onclick = showLogin;

        document.getElementById('loginForm').onsubmit = function(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (users[email] && users[email].password === password) {
                currentUser = users[email];
                document.getElementById('welcomeUser').textContent = `Welcome, ${currentUser.name}!`;
                showDashboard();
            } else {
                alert('Invalid email or password');
            }
        };

        document.getElementById('registerForm').onsubmit = function(e) {
            e.preventDefault();
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (password !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }
            
            if (users[email]) {
                alert('Email already registered');
                return;
            }
            
            users[email] = { name, email, password };
            localStorage.setItem('datapro_users', JSON.stringify(users));
            alert('Account created successfully! Please login.');
            showLogin();
            document.getElementById('registerForm').reset();
        };

        // File handling functions
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const fileInfo = document.getElementById('fileInfo');
            fileInfo.innerHTML = `
                <strong>File:</strong> ${file.name}<br>
                <strong>Size:</strong> ${(file.size / 1024 / 1024).toFixed(2)} MB<br>
                <strong>Type:</strong> ${file.type || file.name.split('.').pop().toUpperCase()}
            `;

            const reader = new FileReader();
            reader.onload = function(e) {
                if (file.name.endsWith('.csv')) {
                    parseCSV(e.target.result);
                } else if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                    parseExcel(e.target.result);
                }
            };

            if (file.name.endsWith('.csv')) {
                reader.readAsText(file);
            } else {
                reader.readAsArrayBuffer(file);
            }
        }

        function parseCSV(csvText) {
            Papa.parse(csvText, {
                header: true,
                dynamicTyping: true,
                skipEmptyLines: true,
                complete: function(results) {
                    currentData = results.data;
                    updateDataPreview();
                    updateStats();
                    populateAxisSelectors();
                }
            });
        }

        function parseExcel(arrayBuffer) {
            const workbook = XLSX.read(arrayBuffer, { type: 'array' });
            const firstSheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[firstSheetName];
            const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
            
            if (jsonData.length > 0) {
                const headers = jsonData[0];
                const data = jsonData.slice(1).map(row => {
                    const obj = {};
                    headers.forEach((header, index) => {
                        obj[header] = row[index];
                    });
                    return obj;
                });
                currentData = data;
                updateDataPreview();
                updateStats();
                populateAxisSelectors();
            }
        }

        function updateDataPreview() {
            const preview = document.getElementById('dataPreview');
            if (!currentData || currentData.length === 0) {
                preview.innerHTML = '<div class="no-data">No data to display</div>';
                return;
            }

            const headers = Object.keys(currentData[0]);
            const sampleData = currentData.slice(0, 5);
            
            let tableHTML = '<table class="preview-table"><thead><tr>';
            headers.forEach(header => {
                tableHTML += `<th>${header}</th>`;
            });
            tableHTML += '</tr></thead><tbody>';
            
            sampleData.forEach(row => {
                tableHTML += '<tr>';
                headers.forEach(header => {
                    const value = row[header] !== undefined ? row[header] : '';
                    tableHTML += `<td>${String(value).substring(0, 20)}${String(value).length > 20 ? '...' : ''}</td>`;
                });
                tableHTML += '</tr>';
            });
            
            tableHTML += '</tbody></table>';
            if (currentData.length > 5) {
                tableHTML += `<p style="margin-top: 10px; font-size: 0.8rem; color: #666;">Showing 5 of ${currentData.length} rows</p>`;
            }
            
            preview.innerHTML = tableHTML;
        }

        function updateStats() {
            if (!currentData || currentData.length === 0) {
                document.getElementById('totalRows').textContent = '0';
                document.getElementById('totalColumns').textContent = '0';
                document.getElementById('numericColumns').textContent = '0';
                document.getElementById('textColumns').textContent = '0';
                return;
            }

            const headers = Object.keys(currentData[0]);
            let numericCount = 0;
            let textCount = 0;

            headers.forEach(header => {
                const values = currentData.map(row => row[header]).filter(val => val !== null && val !== undefined && val !== '');
                if (values.length > 0) {
                    const isNumeric = values.every(val => !isNaN(parseFloat(val)) && isFinite(val));
                    if (isNumeric) {
                        numericCount++;
                    } else {
                        textCount++;
                    }
                }
            });

            document.getElementById('totalRows').textContent = currentData.length.toLocaleString();
            document.getElementById('totalColumns').textContent = headers.length.toString();
            document.getElementById('numericColumns').textContent = numericCount.toString();
            document.getElementById('textColumns').textContent = textCount.toString();
        }

        function populateAxisSelectors() {
            if (!currentData || currentData.length === 0) return;

            const headers = Object.keys(currentData[0]);
            const xAxisSelect = document.getElementById('xAxis');
            const yAxisSelect = document.getElementById('yAxis');

            // Clear existing options
            xAxisSelect.innerHTML = '<option value="">Select column...</option>';
            yAxisSelect.innerHTML = '<option value="">Select column...</option>';

            headers.forEach(header => {
                const option1 = document.createElement('option');
                option1.value = header;
                option1.textContent = header;
                xAxisSelect.appendChild(option1);

                const option2 = document.createElement('option');
                option2.value = header;
                option2.textContent = header;
                yAxisSelect.appendChild(option2);
            });
        }
        function updateChart() {
    chartType = document.getElementById('chartType').value;
    const xAxis = document.getElementById('xAxis').value;
    const yAxis = document.getElementById('yAxis').value;

    if (!currentData || !xAxis || !yAxis) {
        document.getElementById('noChartMessage').style.display = 'block';
        if (currentChart) {
            currentChart.destroy();
            currentChart = null;
        }
        return;
    }

    document.getElementById('noChartMessage').style.display = 'none';

    let labels = [];
    let data = [];

    // 🔹 Scatter / Bubble
    if (chartType === "scatter" || chartType === "bubble") {
        data = currentData.map(row => {
            const xVal = parseFloat(row[xAxis]);
            const yVal = parseFloat(row[yAxis]);
            if (!isNaN(xVal) && !isNaN(yVal)) {
                return (chartType === "bubble")
                    ? { x: xVal, y: yVal, r: Math.random() * 15 + 5 }
                    : { x: xVal, y: yVal };
            }
            return null;
        }).filter(item => item !== null);
    // 🔹 Normal Charts (Bar, Line, Area, Pie, Doughnut, Polar, Radar)
    } else {
        const dataMap = new Map();
        currentData.forEach(row => {
            const xVal = row[xAxis];
            const yVal = parseFloat(row[yAxis]);
            if (xVal !== undefined && !isNaN(yVal)) {
                dataMap.set(xVal, (dataMap.get(xVal) || 0) + yVal);
            }
        });
        labels = Array.from(dataMap.keys()).slice(0, 20);
        data = labels.map(label => dataMap.get(label));
    }

    // 🎨 Colors
    const colorCount = (labels.length || data.length || 1);
    const backgroundColors = Array.from({ length: colorCount }, (_, index) =>
        `hsla(${(index * 360 / colorCount)}, 70%, 60%, 0.7)`
    );
    const borderColors = Array.from({ length: colorCount }, (_, index) =>
        `hsla(${(index * 360 / colorCount)}, 70%, 40%, 1)`
    );

    // 🖌️ Destroy old chart if exists
    const ctx = document.getElementById('mainChart').getContext('2d');
    if (currentChart) currentChart.destroy();

    // 🆕 Chart Config
    const config = {
        type: (chartType === "area") ? "line" :
              (chartType === "timeseries") ? "line" : chartType,
        data: {
            labels: (chartType === "scatter" || chartType === "bubble" || chartType === "timeseries")
                ? undefined : labels,
            datasets: [{
                label: yAxis,
                data: data,
                backgroundColor: backgroundColors,
                borderColor: borderColors,
                borderWidth: 2,
                fill: (chartType === "area"), // Area chart के लिए fill
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: (chartType === 'pie' || chartType === 'doughnut' || chartType === 'polarArea' || chartType === 'radar'),
                    position: 'right'
                }
            },
            scales: (chartType === 'pie' || chartType === 'doughnut' || chartType === 'polarArea' || chartType === 'radar') ? {} : {
                x: {
                    type: (chartType === "timeseries") ? "time" :
                          (chartType === "scatter" || chartType === "bubble") ? "linear" : "category",
                    time: (chartType === "timeseries") ? { unit: "day" } : undefined,
                    title: { display: true, text: xAxis }
                },
                y: {
                    title: { display: true, text: yAxis },
                    beginAtZero: !(chartType === "scatter" || chartType === "bubble" || chartType === "timeseries")
                }
            }
        }
    };

    // 🔹 Create chart
    currentChart = new Chart(ctx, config);
}

        async function saveChartAsPDF() {
    if (!currentChart) {
        alert("⚠️ Please generate a chart first!");
        return;
    }

    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF("landscape");

    // Chart title
    pdf.setFontSize(18);
    pdf.text("📊 Data Visualization Report", 15, 20);

    // Convert chart to image
    const canvas = document.getElementById("mainChart");
    const chartImage = canvas.toDataURL("image/png", 1.0);

    // Add chart to PDF
    pdf.addImage(chartImage, "PNG", 15, 30, 260, 120);

    // Save PDF
    pdf.save("chart-report.pdf");
}


        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is already logged in (for demo purposes)
            const savedUser = localStorage.getItem('datapro_current_user');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                document.getElementById('welcomeUser').textContent = `Welcome, ${currentUser.name}!`;
                showDashboard();
            }
        });

        // Save current user on login for persistence
        function saveCurrentUser() {
            if (currentUser) {
                localStorage.setItem('datapro_current_user', JSON.stringify(currentUser));
            }
        }

        // Update login function to save user
        const originalLogin = document.getElementById('loginForm').onsubmit;
        document.getElementById('loginForm').onsubmit = function(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (users[email] && users[email].password === password) {
                currentUser = users[email];
                document.getElementById('welcomeUser').textContent = `Welcome, ${currentUser.name}!`;
                saveCurrentUser();
                showDashboard();
            } else {
                alert('Invalid email or password');
            }
        };

        // Update logout to clear saved user
        function logout() {
            currentUser = null;
            localStorage.removeItem('datapro_current_user');
            document.getElementById('dashboard').classList.remove('active');
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('loginForm').reset();
            
            // Clear chart data
            if (currentChart) {
                currentChart.destroy();
                currentChart = null;
            }
            currentData = null;
            updateDataPreview();
            updateStats();
        }
    </script>
</body>
